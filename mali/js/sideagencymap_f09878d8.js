"use strict";$(function(){function t(t,e){console.log(11111,t,e),this._point=t,this._text=e.name,this._child=e.id}function e(t,e,n){this._point=t,this._text=e.name,this._child=e.id,this._number=e.number,this._areaFlag=n}function n(){tool.ajax("area:areas/0/subList",{},function(t){for(var n=t.data.content,l=function(t){var l=n[t];tool.ajax("dealer:dealers",{provinceId:l.id},function(t){l.number=t.data.totalElements,a.level=2,BMap.Convertor.translate(new BMap.Point(l.lng,l.lat),2,function(t){var n=new e(new BMap.Point(t.lng,t.lat),l,a);i.addOverlay(n)})})},o=0;o<n.length;o++)l(o)})}$(".banner-right li:eq(4)").addClass("active").siblings().removeClass("active");var a={level:1,provinceId:null,cityId:null,districtId:null},i=new BMap.Map("allmap"),l=new BMap.Point(116,33);i.enableScrollWheelZoom(),i.centerAndZoom(l,5),t.prototype=new BMap.Overlay,t.prototype.initialize=function(t){this._map=t;var e=this._div2=document.createElement("a");e.style.zIndex=BMap.Overlay.getZIndex(this._point.lat),e.setAttribute("href","sideagency.html?id="+this._child),e.setAttribute("class","circlebox"),e.setAttribute("target","_blank");var n=document.createElement("div");n.setAttribute("class","bg-circle"),e.appendChild(n);var a=document.createElement("div");a.setAttribute("class","sm-circle"),e.appendChild(a);var i=document.createElement("div");i.setAttribute("class","line"),e.appendChild(i);var l=document.createElement("div");return l.setAttribute("class","ctx"),l.setAttribute("title","点击查看经销商详情"),l.appendChild(document.createTextNode(this._text)),e.appendChild(l),e.onmouseover=function(){e.style.zIndex=99999999,e.setAttribute("class","circlebox hoverbox")},e.onmouseout=function(){e.setAttribute("class","circlebox")},t.getPanes().labelPane.appendChild(e),e},t.prototype.draw=function(){var t=this._map,e=t.pointToOverlayPixel(this._point);this._div2.style.left=e.x+"px",this._div2.style.top=e.y+"px"},e.prototype=new BMap.Overlay,e.prototype.initialize=function(n){var i=this;i._map=n;var l=i._div=document.createElement("div");l.style.zIndex=BMap.Overlay.getZIndex(i._point.lat),l.setAttribute("data-id",i._child),l.setAttribute("class","map-circle"),l.setAttribute("data-lng",i._point.lng),l.setAttribute("data-lat",i._point.lat);var o=document.createElement("p");o.setAttribute("class","map-areaname"),o.appendChild(document.createTextNode(i._text)),l.appendChild(o);var r=document.createElement("p");if(r.setAttribute("class","map-areanumber"),l.appendChild(r),r.appendChild(document.createTextNode(i._number+"个")),l.onmouseover=function(){this.style.zIndex=9999},l.onmouseout=function(){this.style.zIndex=BMap.Overlay.getZIndex(i._point.lat)},0==i._number){var d=document.createElement("span");d.setAttribute("class","map-nodatatips"),d.appendChild(document.createTextNode("暂无数据")),l.appendChild(d);var s=document.createElement("i");s.setAttribute("class","map-itips"),d.appendChild(s)}return l.onclick=function(){if(!a.districtId&&0!=i._number){var o=parseInt(l.getAttribute("data-id")),r=parseInt(l.getAttribute("data-lng")),d=parseInt(l.getAttribute("data-lat"));2==a.level&&(a.provinceId=o),3==a.level&&(a.cityId=o),tool.ajax("area:areas/"+o+"/subList",{},function(i){n.clearOverlays();var l=new BMap.Point(r,d);n.enableScrollWheelZoom(),n.centerAndZoom(l,2==a.level?8:9);for(var o=function(i,o){2==a.level&&(a.cityId=o[i].id),3==a.level&&(a.districtId=o[i].id),tool.ajax("dealer:dealers",a,function(r){o[i].number=r.data.content.length&&r.data.totalElements,a.level=3,BMap.Convertor.translate(new BMap.Point(o[i].lng,o[i].lat),2,function(d){var s=new e(new BMap.Point(d.lng,d.lat),o[i],a);if(n.addOverlay(s),a.districtId){for(var c=function(e,a){BMap.Convertor.translate(new BMap.Point(a[e].shopLon,a[e].shopLat),2,function(i){a[e].lng=i.lng,a[e].lat=i.lat;var l=new t(new BMap.Point(i.lng,i.lat),a[e]);n.addOverlay(l)})},p=0,u=r.data.content;p<u.length;p++)c(p,u);n.centerAndZoom(l,10)}})})},s=0,c=i.data.content;s<c.length;s++)o(s,c)})}},n.getPanes().labelPane.appendChild(l),l},e.prototype.draw=function(){var t=this._map,e=t.pointToOverlayPixel(this._point);this._div.style.left=e.x+"px",this._div.style.top=e.y+"px"},n();var o=function(t){t=t||window.event;var e=(document.getElementById("allmap"),i.getZoom());8>e&&(a={level:1,provinceId:null,cityId:null,districtId:null},i.clearOverlays(),new BMap.Point(116,33),n())};document.addEventListener&&document.addEventListener("DOMMouseScroll",o,!1),window.onmousewheel=document.onmousewheel=o});