"use strict";$(function(){function e(e,i){i.children("option:not(.not-remove)").remove(),tool.ajax("area:areas/"+e+"/subList",{},function(e){var n="",t=e.data.content;if(t.length>0)for(var a=e.data.content,o=0;o<a.length;o++)n+='<option data-id="'+a[o].id+'" value="'+a[o].name+'">'+a[o].name+"</option>";else n="暂无数据";i.append(n)})}function i(e,i,n){setTimeout(function(){i.parent(".item-container").show()},100),n||tool.ajax(e,{},function(e){var n="",t=e.data.content;if(t.length>0)for(var a=e.data.content,o=0;o<a.length;o++)n+='<li data-id="'+a[o].id+'" data-name="'+a[o].name+'">'+a[o].name+"</li>";else n="暂无数据";i.append(n)})}$(".banner-right li:eq(1)").addClass("active").siblings().removeClass("active");var n,t,a=!1,o=!1,s=!1,c=!1,r="",d={images:[]},l={};n=new AMap.Map("container",{resizeEnable:!0}),n.plugin("AMap.Geolocation",function(){t=new AMap.Geolocation({enableHighAccuracy:!0,timeout:1e4,buttonOffset:new AMap.Pixel(10,20),zoomToAccuracy:!0,buttonPosition:"RB"}),n.addControl(t),t.getCurrentPosition(),AMap.event.addListener(t,"complete",function(e){d.lon=e.position.lng,d.lat=e.position.lat})}),e(0,$("#province10")),$("#province10").change(function(){$("#district10").children("option:not(.not-remove)").remove();var i=$(this).children("option:selected").data("id");d.provinceId=i,i?e(i,$("#city10")):$("#city10").children("option:not(.not-remove)").remove()}),$("#city10").change(function(){var i=$(this).children("option:selected").data("id");d.cityId=i,i?e(i,$("#district10")):$("#district10").children("option:not(.not-remove)").remove()}),$("#district10").change(function(){var e=$(this).children("option:selected").data("id");d.districtId=e}),$(".chosen-pinglei input").focus(function(){$(this).parent(".chosen-item").siblings(".chosen-item").children(".item-container,.brand-model").hide(),i("machine:category/children/0",$(".chosen-pinglei .item-box"),a),a=!0}),$(".chosen-pinglei .item-box").on("click","li",function(){var e=$(this).data("id");d.categoryId=e;var i=$(this).data("name");$(this).parents(".item-container").siblings("input").val(i),$(this).parents(".item-container").hide()}),$(".chosen-brand input").focus(function(){$(this).parent(".chosen-item").siblings(".chosen-item").children(".item-container,.brand-model").hide(),i("machine:brand?page=0&size=200",$(".brand-model .brand-content"),o),$(".brandmodel-tab li").eq(0).addClass("active").siblings().removeClass("active"),$(".brand-model").show(),$(".brand-content").show(),$(".model-content").hide(),o=!0}),$(".brandmodel-tab li").click(function(){var e=$(this).index();$(".brandmodel-content").eq(e).show().siblings(".brandmodel-content").hide(),$(this).addClass("active").siblings().removeClass("active")}),$(".brand-content").on("click","li",function(){var e=$(this).data("id");r=$(this).data("name"),d.brandId=e,$(".model-content").children().remove(),i("machine:model?page=0&size=200&brandId="+e,$(".brand-model .model-content"),!1),$(".brand-content").hide(),$(".model-content").show(),$(".brandmodel-tab li:nth-child(2)").addClass("active").siblings().removeClass("active"),$(".brandmodel-input").val("品牌："+r)}),$(".model-content").on("click","li",function(){var e=$(this).data("id"),i=$(this).data("name");d.modelId=e,$(".brand-model").hide(),$(".brandmodel-input").val("品牌："+r+" ，型号："+i)}),$(".close-chosenbox").click(function(){$(this).parent(".item-container,.brand-model").hide()}),$(".chosen-brand .item-box").on("click","li",function(){var e=$(this).data("id");d.brandId=e;var i=$(this).data("name");$(this).parents(".item-container").siblings("input").val(i),$(this).parents(".item-container").hide()}),$(".chosen-horsepower input").focus(function(){$(this).parent(".chosen-item").siblings(".chosen-item").children(".item-container,.brand-model").hide(),i("machine:horsepower-section?page=0&size=100",$(".chosen-horsepower .item-box"),s),s=!0}),$(".chosen-horsepower .item-box").on("click","li",function(){var e=$(this).data("id");d.horsepower=e;var i=$(this).data("name");$(this).parents(".item-container").siblings("input").val(i),$(this).parents(".item-container").hide()}),$(".chosen-time input").focus(function(){$(this).parent(".chosen-item").siblings(".chosen-item").children(".item-container,.brand-model").hide(),i("machine:usedtime-section?page=0&size=100",$(".chosen-time .item-box"),c),c=!0}),$(".chosen-time .item-box").on("click","li",function(){var e=$(this).data("id");d.usedTime=e;var i=$(this).data("name");$(this).parents(".item-container").siblings("input").val(i),$(this).parents(".item-container").hide()}),$(".close-form,.my-know").click(function(){$(".form-tipxbox,.mask").hide()}),$(".sell-btn").click(function(){if(0==d.images.length)return $(".error-tipsbox div").text("请上传图片"),void $(".form-tipxbox,.mask").show();$(".buy-time").val()||(d.boughtTime=$(".buy-time").val()+" 00:00:00"),d.description=$(".address-detail").val(),d.price=$(".price-input").val(),l.phone=$(".input-phone").val();for(var e=[{name:"categoryId",tips:"请选择农机品类"},{name:"brandId",tips:"请选择品牌"},{name:"modelId",tips:"请选择型号"},{name:"horsepower",tips:"请选择配套动力"},{name:"boughtTime",tips:"请填写购买时间"},{name:"usedTime",tips:"请选择行驶时间"},{name:"price",tips:"请填写转让价格"},{name:"description",tips:"请输入农机的具体描述"},{name:"provinceId",tips:"请选择省份"},{name:"cityId",tips:"请选择市级"},{name:"districtId",tips:"请选择县区"},{name:"phone",tips:"请填写手机号码"}],i=0;i<e.length;i++)if(!d[e[i].name])return $(".error-tipsbox div").text(e[i].tips),void $(".form-tipxbox,.mask").show();l.userId=2074}),$("#uploadPic1").change(function(){var e=new FormData;e.append("files",$("#uploadPic1").prop("files")[0]),$.ajax({type:"post",url:rootApi+"vendor:oss/files",data:e,processData:!1,contentType:!1,dataType:"json",success:function(e){if(console.log("success",e),0!=e.code)return $(".error-tipsbox div").text("上传失败，稍后重试"),void $(".form-tipxbox,.mask").show();d.images.push(rootUpload+e.data.content[0]),console.log(d.images);var i="";$(".chosen-images .img-list").children().remove();for(var n=0;n<d.images.length;n++)i+='<li>\n    					<a name="del-images" class="del-images" data-index="'+n+'" href="javascript:;"></a>\n    					<img src="'+d.images[n]+'" alt="">\n    				</li>';$(".chosen-images .img-list").append(i)},error:function(){$(".error-tipsbox div").text("上传失败，稍后重试"),$(".form-tipxbox,.mask").show()}})}),$(".chosen-images .img-list").on("click",".del-images",function(){var e=$(this).data("index");d.images.splice(e,1);var i="";$(".chosen-images .img-list").children().remove();for(var n=0;n<d.images.length;n++)i+='<li>\n        <a data-index="'+n+'" href="javascript:;"></a>\n        <img src="'+d.images[n]+'" alt="">\n      </li>';$(".chosen-images .img-list").append(i)})});