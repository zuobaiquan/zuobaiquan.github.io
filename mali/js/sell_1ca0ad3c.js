"use strict";$(function(){function e(e,i){i.children("option:not(.not-remove)").remove(),tool.ajax("area:areas/"+e+"/subList",{},function(e){var t="",o=e.data.content;if(o.length>0)for(var n=e.data.content,a=0;a<n.length;a++)t+='<option data-id="'+n[a].id+'" value="'+n[a].name+'">'+n[a].name+"</option>";else t="暂无数据";i.append(t)})}function i(e,i,t){setTimeout(function(){i.parent(".item-container").show()},100),t||tool.ajax(e,{},function(e){var t="",o=e.data.content;if(o.length>0)for(var n=e.data.content,a=0;a<n.length;a++)t+='<li data-id="'+n[a].id+'" data-name="'+n[a].name+'">'+n[a].name+"</li>";else t="暂无数据";i.append(t)})}$(".banner-right li:eq(1)").addClass("active").siblings().removeClass("active"),$(".distribute-box").hide(),$.cookie("userId")||($(".error-tipsbox div").text("请先登陆，再发布农机！"),$(".form-tipxbox,.mask").show(),$(".my-know").click(function(){window.location.href="login.html"}),setTimeout(function(){window.location.href="login.html"},2e3));var t,o,n,a,s,r,c=!1,d=!1,l=!1,m=!1,h={images:[],boughtTime:""},p={};s=new AMap.Map("container",{resizeEnable:!0}),s.plugin("AMap.Geolocation",function(){r=new AMap.Geolocation({enableHighAccuracy:!0,timeout:1e4,buttonOffset:new AMap.Pixel(10,20),zoomToAccuracy:!0,buttonPosition:"RB"}),s.addControl(r),r.getCurrentPosition(),AMap.event.addListener(r,"complete",function(e){h.lon=e.position.lng,h.lat=e.position.lat})}),e(0,$("#province10")),$("#province10").change(function(){$("#district10").children("option:not(.not-remove)").remove();var i=$(this).children("option:selected").data("id");h.provinceId=i,i?e(i,$("#city10")):$("#city10").children("option:not(.not-remove)").remove()}),$("#city10").change(function(){var i=$(this).children("option:selected").data("id");h.cityId=i,i?e(i,$("#district10")):$("#district10").children("option:not(.not-remove)").remove()}),$("#district10").change(function(){var e=$(this).children("option:selected").data("id");h.districtId=e}),$(".chosen-pinglei input").focus(function(){$(this).parent(".chosen-item").siblings(".chosen-item").children(".item-container,.brand-model").hide(),i("machine:category/children/0",$(".brand-model .category-content1"),c),$(".chosen-pinglei .category-tab li").eq(0).addClass("active").siblings().removeClass("active"),$(".chosen-pinglei .brand-model").show(),$(".category-content1").show(),$(".category-content2").hide(),c=!0}),$(".chosen-pinglei .category-content1").on("click","li",function(){var e=($(this).data("id"),$(this).data("name"));$(this).parents(".item-container").siblings("input").val(e),$(this).parents(".item-container").hide()}),$(".chosen-brand input").focus(function(){$(this).parent(".chosen-item").siblings(".chosen-item").children(".item-container,.brand-model").hide(),i("machine:brand?page=0&size=200",$(".chosen-brand .brand-content"),d),$(".chosen-brand .brandmodel-tab li").eq(0).addClass("active").siblings().removeClass("active"),$(".chosen-brand .brand-model").show(),$(".brand-content").show(),$(".model-content").hide(),d=!0}),$(".category-tab li").click(function(){var e=$(this).index();$(this).parent().siblings(".brandmodel-content").eq(e).show().siblings(".brandmodel-content").hide(),$(this).addClass("active").siblings().removeClass("active")}),$(".category-content1").on("click","li",function(){var e=$(this).data("id");n=$(this).data("name"),$(".category-content2").children().remove(),i("machine:category/children/"+e,$(".brand-model .category-content2"),!1),$(".category-content1").hide(),$(".category-content2").show(),$(".category-tab li:nth-child(2)").addClass("active").siblings().removeClass("active"),$(".category-input").val("一级分类："+n)}),$(".category-content2").on("click","li",function(){var e=$(this).data("id");a=$(this).data("name"),h.categoryId=e,$(".chosen-pinglei .brand-model").hide(),$(".category-input").val("一级分类："+n+" ，二级分类："+a)}),$(".brandmodel-tab li").click(function(){var e=$(this).index();$(this).parent().siblings(".brandmodel-content").eq(e).show().siblings(".brandmodel-content").hide(),$(this).addClass("active").siblings().removeClass("active")}),$(".brand-content").on("click","li",function(){var e=$(this).data("id");t=$(this).data("name"),h.brandId=e,$(".model-content").children().remove(),i("machine:model?page=0&size=200&brandId="+e,$(".brand-model .model-content"),!1),$(".brand-content").hide(),$(".model-content").show(),$(".brandmodel-tab li:nth-child(2)").addClass("active").siblings().removeClass("active"),$(".brandmodel-input").val("品牌："+t)}),$(".model-content").on("click","li",function(){var e=$(this).data("id");o=$(this).data("name"),h.modelId=e,$(".chosen-brand .brand-model").hide(),$(".brandmodel-input").val("品牌："+t+" ，型号："+o)}),$(".close-chosenbox").click(function(){$(this).parent(".item-container,.brand-model").hide()}),$(".chosen-horsepower input").focus(function(){$(this).parent(".chosen-item").siblings(".chosen-item").children(".item-container,.brand-model").hide(),i("machine:horsepower-section?page=0&size=100",$(".chosen-horsepower .item-box"),l),l=!0}),$(".chosen-horsepower .item-box").on("click","li",function(){var e=$(this).data("id");h.horsepower=e;var i=$(this).data("name");$(this).parents(".item-container").siblings("input").val(i),$(this).parents(".item-container").hide()}),$(".chosen-time input").focus(function(){$(this).parent(".chosen-item").siblings(".chosen-item").children(".item-container,.brand-model").hide(),i("machine:usedtime-section?page=0&size=100",$(".chosen-time .item-box"),m),m=!0}),$(".chosen-time .item-box").on("click","li",function(){var e=$(this).data("id");h.usedTime=e;var i=$(this).data("name");$(this).parents(".item-container").siblings("input").val(i),$(this).parents(".item-container").hide()}),$(".buy-time").each(function(){$(this).ionDatePicker({lang:"zh-cn",format:"YYYY-MM-DD",onReady:function(e){h.boughtTime=e+" 00:00:00",h.boughtTime=new Date(h.boughtTime).toISOString()}})}),h.boughtTime="",$(".sell-btn").click(function(){if(0==h.images.length)return $(".error-tipsbox div").text("请上传图片"),void $(".form-tipxbox,.mask").show();h.description=$(".address-detail").val(),h.price=$(".price-input").val(),p.phone=$(".input-phone").val();for(var e=[{name:"categoryId",tips:"请选择农机品类"},{name:"brandId",tips:"请选择品牌"},{name:"modelId",tips:"请选择型号"},{name:"horsepower",tips:"请选择配套动力"},{name:"boughtTime",tips:"请填写购买时间"},{name:"usedTime",tips:"请选择行驶时间"},{name:"price",tips:"请填写转让价格"},{name:"description",tips:"请输入农机的具体描述"},{name:"provinceId",tips:"请选择省份"},{name:"cityId",tips:"请选择市级"},{name:"districtId",tips:"请选择县区"}],i=0;i<e.length;i++)if(!h[e[i].name])return $(".error-tipsbox div").text(e[i].tips),void $(".form-tipxbox,.mask").show();if(h.price=+h.price,!/(^[1-9]\d*(\.\d{1,2})?$)|(^0(\.\d{1,2})?$)/.test(h.price))return $(".error-tipsbox div").text("转让价格格式错误"),void $(".form-tipxbox,.mask").show();if(!p.phone)return $(".error-tipsbox div").text("请填写手机号码"),void $(".form-tipxbox,.mask").show();if(!/^[1][3,4,5,7,8][0-9]{9}$/.test(p.phone))return $(".error-tipsbox div").text("手机号码格式错误"),void $(".form-tipxbox,.mask").show();if(!p.image)return $(".error-tipsbox div").text("请上传购买凭证图片"),void $(".form-tipxbox,.mask").show();h.userId=parseInt($.cookie("userId"));for(var i=0;i<h.images.length;i++)h.images[i]=h.images[i].replace(rootUpload,"");h.title=a+" "+t+" "+o,tool.ajax2("machine:machine",h,function(e){0==e.code?(p.machineId=e.data.id,p.userId=h.userId,tool.ajax2("machine:publish",p,function(e){return 0==e.code?($(".form-tipxbox").addClass("form-successbox2 form-successbox3"),$(".error-tipsbox div").text("您提交的信息我们会进行人工审核，电话会做保密处理不做显示，届时请留意接听 0431-84808999 客服电话，更快成交有保障。审核通过后会在24小时内上线，感谢您对大马力的支持"),void $(".form-tipxbox,.mask").show()):($(".error-tipsbox div").text("发布失败，稍后重试！"),void $(".form-tipxbox,.mask").show())})):($(".error-tipsbox div").text("发布失败，稍后重试！"),$(".form-tipxbox,.mask").show())})}),$(".close-form,.my-know").click(function(){$(".form-tipxbox").hasClass("form-successbox3")?($(".form-tipxbox").addClass("form-successbox").removeClass("form-successbox2"),$(".error-tipsbox div").html("耐心等待客服联系，<br />正跳转个人中心..."),$(".form-tipxbox,.mask").show(),setTimeout(function(){window.location.href="my.html?tag=2"},2500)):($(".form-tipxbox,.mask").hide(),$(".form-tipxbox").removeClass("form-successbox form-successbox2 form-successbox3"))}),$("#uploadPic1").change(function(){var e=new FormData;e.append("files",$("#uploadPic1").prop("files")[0]),$.ajax({type:"post",url:rootApi+"vendor:oss/files",data:e,processData:!1,contentType:!1,dataType:"json",success:function(e){if(0!=e.code)return $(".error-tipsbox div").text("上传失败，稍后重试"),void $(".form-tipxbox,.mask").show();h.images.push(rootUpload+e.data.content[0]);var i="";$(".chosen-images .img-list").children().remove();for(var t=0;t<h.images.length;t++)i+='<li>\n    					<a name="del-images" class="del-images" data-index="'+t+'" href="javascript:;"></a>\n    					<img src="'+h.images[t]+'" alt="">\n    				</li>';$(".chosen-images .img-list").append(i)},error:function(){$(".error-tipsbox div").text("上传失败，稍后重试"),$(".form-tipxbox,.mask").show()}})}),$("#uploadPic2").change(function(){var e=new FormData;e.append("files",$("#uploadPic2").prop("files")[0]),$.ajax({type:"post",url:rootApi+"vendor:oss/files",data:e,processData:!1,contentType:!1,dataType:"json",success:function(e){return 0!=e.code?($(".error-tipsbox div").text("上传失败，稍后重试"),void $(".form-tipxbox,.mask").show()):(p.image=rootUpload+e.data.content[0],void $(".pingzheng-pic").attr("src",rootUpload+e.data.content[0]).show())},error:function(){$(".error-tipsbox div").text("上传失败，稍后重试"),$(".form-tipxbox,.mask").show()}})}),$(".chosen-images .img-list").on("click",".del-images",function(){var e=$(this).data("index");h.images.splice(e,1);var i="";$(".chosen-images .img-list").children().remove();for(var t=0;t<h.images.length;t++)i+='<li>\n        <a data-index="'+t+'" href="javascript:;"></a>\n        <img src="'+h.images[t]+'" alt="">\n      </li>';$(".chosen-images .img-list").append(i)})});