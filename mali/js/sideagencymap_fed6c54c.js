"use strict";$(function(){function e(e,t){this._point=e,this._text=t.name,this._child=t.id}function t(e,t,n){this._point=e,this._text=t.name,this._child=t.id,this._number=t.number,this._areaFlag=n}function n(){tool.ajax("area:areas/0/subList",{},function(e){for(var n=e.data.content,l=function(e){var l=n[e];tool.ajax("dealer:dealers",{provinceId:l.id},function(e){l.number=e.data.totalElements,a.level=2;var n=new t(new BMap.Point(l.lng,l.lat),l,a);i.addOverlay(n)})},o=0;o<n.length;o++)l(o)})}$(".banner-right li:eq(4)").addClass("active").siblings().removeClass("active");var a={level:1,provinceId:null,cityId:null,districtId:null},i=new BMap.Map("allmap"),l=new BMap.Point(116,33);i.enableScrollWheelZoom(),i.centerAndZoom(l,5),e.prototype=new BMap.Overlay,e.prototype.initialize=function(e){this._map=e;var t=this._div2=document.createElement("a");t.style.zIndex=BMap.Overlay.getZIndex(this._point.lat),t.setAttribute("href","sideagency.html?id="+this._child),t.setAttribute("class","circlebox"),t.setAttribute("target","_blank");var n=document.createElement("div");n.setAttribute("class","bg-circle"),t.appendChild(n);var a=document.createElement("div");a.setAttribute("class","sm-circle"),t.appendChild(a);var i=document.createElement("div");i.setAttribute("class","line"),t.appendChild(i);var l=document.createElement("div");return l.setAttribute("class","ctx"),l.setAttribute("title","点击查看经销商详情"),l.appendChild(document.createTextNode(this._text)),t.appendChild(l),t.onmouseover=function(){t.style.zIndex=99999999,t.setAttribute("class","circlebox hoverbox")},t.onmouseout=function(){t.setAttribute("class","circlebox")},e.getPanes().labelPane.appendChild(t),t},e.prototype.draw=function(){var e=this._map,t=e.pointToOverlayPixel(this._point);this._div2.style.left=t.x+"px",this._div2.style.top=t.y+"px"},t.prototype=new BMap.Overlay,t.prototype.initialize=function(n){var i=this;i._map=n;var l=i._div=document.createElement("div");l.style.zIndex=BMap.Overlay.getZIndex(i._point.lat),l.setAttribute("data-id",i._child),l.setAttribute("class","map-circle"),l.setAttribute("data-lng",i._point.lng),l.setAttribute("data-lat",i._point.lat);var o=document.createElement("p");o.setAttribute("class","map-areaname"),o.appendChild(document.createTextNode(i._text)),l.appendChild(o);var r=document.createElement("p");if(r.setAttribute("class","map-areanumber"),l.appendChild(r),r.appendChild(document.createTextNode(i._number+"个")),l.onmouseover=function(){this.style.zIndex=9999},l.onmouseout=function(){this.style.zIndex=BMap.Overlay.getZIndex(i._point.lat)},0==i._number){var d=document.createElement("span");d.setAttribute("class","map-nodatatips"),d.appendChild(document.createTextNode("暂无数据")),l.appendChild(d);var s=document.createElement("i");s.setAttribute("class","map-itips"),d.appendChild(s)}return l.onclick=function(){if(console.log(i._number),!a.districtId&&0!=i._number){var o=parseInt(l.getAttribute("data-id")),r=parseInt(l.getAttribute("data-lng")),d=parseInt(l.getAttribute("data-lat"));2==a.level&&(a.provinceId=o),3==a.level&&(a.cityId=o),tool.ajax("area:areas/"+o+"/subList",{},function(i){n.clearOverlays();var l=new BMap.Point(r,d);n.enableScrollWheelZoom(),n.centerAndZoom(l,2==a.level?8:9);for(var o=function(i,o){2==a.level&&(a.cityId=o[i].id),3==a.level&&(a.districtId=o[i].id),tool.ajax("dealer:dealers",a,function(r){o[i].number=r.data.content.length&&r.data.totalElements,a.level=3;var d=new t(new BMap.Point(o[i].lng,o[i].lat),o[i],a);if(n.addOverlay(d),a.districtId){for(var s=0,c=r.data.content;s<c.length;s++){var p=new e(new BMap.Point(c[s].shopLon,c[s].shopLat),c[s]);n.addOverlay(p)}n.centerAndZoom(l,10)}})},s=0,c=i.data.content;s<c.length;s++)o(s,c)})}},n.getPanes().labelPane.appendChild(l),l},t.prototype.draw=function(){var e=this._map,t=e.pointToOverlayPixel(this._point);this._div.style.left=t.x+"px",this._div.style.top=t.y+"px"},n();var o=function(e){e=e||window.event;var t=(document.getElementById("allmap"),i.getZoom());8>t&&(a={level:1,provinceId:null,cityId:null,districtId:null},i.clearOverlays(),new BMap.Point(116,33),n())};document.addEventListener&&document.addEventListener("DOMMouseScroll",o,!1),window.onmousewheel=document.onmousewheel=o});