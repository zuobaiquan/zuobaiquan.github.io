webpackJsonp([5],{"+WC7":function(e,t,a){(e.exports=a("FZ+f")(!1)).push([e.i,"\n.el-card__body{\n  padding:10px;\n}\n",""])},"B/0D":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("vMJZ"),i=a("s8Ph"),o={data:function(){return{selectOptions:[],form:{nickName:"",phone:"",intro:"",avatar:"",danceCompany:"",gender:"unset",danceStyle:{id:""}},rules:{nickName:[{required:!0,message:"昵称不能为空",trigger:"blur"}],phone:[{required:!0,message:"手机号码不能为空",trigger:"blur"}],intro:[{required:!0,message:"介绍不能为空",trigger:"blur"}],danceCompany:[{required:!0,message:"舞团不能为空",trigger:"blur"}],avatar:[{required:!0,message:"头像不能为空",trigger:"blur"}],danceStyle:{id:[{required:!0,message:"请选择街舞风格",trigger:"change"}]},gender:[{required:!0,message:"请选择性别",trigger:"blur"}]},baseURL:"http://47.106.228.25:8080/api/oss",edit:this.$route.params.id,flag:this.$route.params.flag,dialogVisible:!1,dialogImageUrl:"",formWorkers:{},editWorks:!1,titleWorks:"",dialogWorks:!1,userposter:[],userworks:[]}},created:function(){var e=this;-1==this.flag?(Object(r.e)({page:0,size:1,id:this.$route.params.editid}).then(function(t){e.form=t.data.data,Object(r.g)({uid:e.$route.params.editid,type:"poster"}).then(function(t){t.data.data.length>0&&t.data.data.map(function(t,a){e.userposter.push({url:t.imageUrl,id:t.id})})}),e.getWorklist()}),this.$route.meta.title="编辑老师"):this.$route.meta.title="添加老师",Object(i.d)({page:0,size:100}).then(function(t){e.selectOptions=t.data.data.content})},methods:{getWorklist:function(){var e=this;Object(r.g)({uid:this.$route.params.editid,type:"works"}).then(function(t){e.userworks=t.data.data})},goBack:function(){this.$router.go(-1)},handlePictureCardPreview:function(e){this.dialogImageUrl=e,e.url&&(this.dialogImageUrl=e.url),this.dialogVisible=!0},handleImageScucess:function(e,t,a){this.form.avatar=e.data},handelErrorForm:function(){return""!=this.form.avatar||(this.$message({message:"请上传头像",type:"warning"}),!1)},submitRes:function(e){var t=this;this.$refs[e].validate(function(e){if(!e||!t.handelErrorForm())return console.log("error submit!!"),!1;console.log("submit!"),-1==t.flag?Object(r.c)({id:t.form.id,danceCompany:t.form.danceCompany,nickName:t.form.nickName,phone:t.form.phone,intro:t.form.intro,avatar:t.form.avatar,gender:t.form.gender,danceStyle:{id:t.form.danceStyle.id}}).then(function(e){200==e.status&&0==e.data.code?(t.$message({message:"修改成功",type:"success"}),t.$router.push({name:"Teacher"})):t.$message({message:e.data.message||"修改失败",type:"warning"})}):Object(r.a)({nickName:t.form.nickName,danceCompany:t.form.danceCompany,phone:t.form.phone,intro:t.form.intro,avatar:t.form.avatar,gender:t.form.gender,danceStyle:{id:t.form.danceStyle.id},type:"teacher"}).then(function(e){200==e.status&&0==e.data.code?(t.$message({message:"添加成功",type:"success"}),t.$router.push({name:"Teacher"})):t.$message({message:e.data.message||"添加失败",type:"warning"})})})},handleImagePoster:function(e,t,a){var i=this;if(e.data){var o=e.data;Object(r.d)({uid:this.form.id,imageUrl:o,type:"poster"}).then(function(e){if(200==e.status&&0==e.data.code)return i.$message({message:"添加成功",type:"success"}),void i.userposter.push({id:e.data.data.id,url:o});i.$message({message:e.data.message||"添加失败",type:"warning"})})}},beforeAvatarUpload:function(e){console.log(e);var t=["image/jpeg","image/gif","image/png"].includes(e.type);return t||this.$message.error("图片格式不正确!"),t},beforeVideoUpload:function(e){console.log(e);var t=["audio/3gpp","audio/mp4","video/mpeg","video/mp4"].includes(e.type);return t||this.$message.error("视频格式不正确!"),t},handleRemove:function(e,t){var a=this;console.log(e),this.userposter.map(function(t,i){t.url==e.url&&Object(r.b)({id:e.id}).then(function(e){e.data&&0==e.data.code?a.userposter.splice(i,1):a.$message({message:"海报图片删除失败",type:"warning"})})})},submitWorker:function(){var e=this;if(this.formWorkers.musicName)if(this.formWorkers.imageUrl)if(this.formWorkers.videoUrl)if(this.formWorkers.videoCoverUrl){var t={uid:this.form.id,imageUrl:this.formWorkers.imageUrl,videoCoverUrl:this.formWorkers.videoCoverUrl,videoUrl:this.formWorkers.videoUrl,musicName:this.formWorkers.musicName,type:"works"};this.editWorks?t.id=this.formWorkers.id:delete t.id,Object(r.d)(t).then(function(t){if(200==t.status&&0==t.data.code)return e.$message({message:e.editWorks?"修改成功":"添加成功",type:"success"}),e.dialogWorks=!1,void e.getWorklist();e.$message({message:t.data.message||(e.editWorks?"修改失败":"添加失败"),type:"warning"})})}else this.$message({message:"请上传视频图片",type:"warning"});else this.$message({message:"请上传视频作品",type:"warning"});else this.$message({message:"请上传封面图片",type:"warning"});else this.$message({message:"背景音乐不能为空",type:"warning"})},addWorksflag:function(e){this.dialogWorks=!0,-1==e?(this.formWorkers.imageUrl="",this.formWorkers.videoCoverUrl="",this.formWorkers.videoUrl="",this.formWorkers.musicName="",this.titleWorks="添加作品",this.editWorks=!1):(this.formWorkers=e,this.titleWorks="编辑作品",this.editWorks=!0)},deleteWorks:function(e){var t=this;Object(r.b)({id:e}).then(function(e){e.data&&0==e.data.code?t.getWorklist():t.$message({message:"作品删除失败",type:"warning"})})},handleVideoUrl:function(e){this.formWorkers.videoUrl=e.data},handleImageUrl:function(e){this.formWorkers.imageUrl=e.data},handleVideoCoverUrl:function(e){this.formWorkers.videoCoverUrl=e.data}}},s={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"120px"}},[a("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"头像",prop:"nickName"}},[a("el-upload",{staticClass:"upload-demo",attrs:{"before-upload":e.beforeAvatarUpload,drag:"","on-success":e.handleImageScucess,action:e.baseURL}},[a("i",{staticClass:"el-icon-upload"}),e._v(" "),a("div",{staticClass:"el-upload__text"},[e._v("将文件拖到此处，或"),a("em",[e._v("点击上传")])])]),e._v(" "),e.form.avatar?a("div",{staticStyle:{"margin-left":"20px",display:"inline-block"}},[a("img",{staticStyle:{"max-width":"200px","max-height":"160px",cursor:"pointer","vertical-align":"middle"},attrs:{src:e.form.avatar,alt:""},on:{click:function(t){e.handlePictureCardPreview(e.form.avatar)}}})]):e._e()],1),e._v(" "),a("el-form-item",{staticStyle:{width:"50%"},attrs:{label:"昵称",prop:"nickName"}},[a("el-input",{model:{value:e.form.nickName,callback:function(t){e.$set(e.form,"nickName",t)},expression:"form.nickName"}})],1),e._v(" "),a("el-form-item",{staticStyle:{width:"50%"},attrs:{label:"电话号码",prop:"phone"}},[a("el-input",{model:{value:e.form.phone,callback:function(t){e.$set(e.form,"phone",t)},expression:"form.phone"}})],1),e._v(" "),a("el-form-item",{staticStyle:{width:"50%"},attrs:{label:"舞团",prop:"danceCompany"}},[a("el-input",{model:{value:e.form.danceCompany,callback:function(t){e.$set(e.form,"danceCompany",t)},expression:"form.danceCompany"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"街舞风格","label-width":"120px",prop:"danceStyle.id"}},[a("el-select",{staticClass:"filter-item",attrs:{clearable:"",placeholder:"请选择"},model:{value:e.form.danceStyle.id,callback:function(t){e.$set(e.form.danceStyle,"id",t)},expression:"form.danceStyle.id"}},e._l(e.selectOptions,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1),e._v(" "),a("el-form-item",{staticStyle:{width:"50%"},attrs:{label:"介绍",prop:"intro"}},[a("el-input",{attrs:{type:"textarea",autosize:{minRows:4,maxRows:6},"auto-complete":"off"},model:{value:e.form.intro,callback:function(t){e.$set(e.form,"intro",t)},expression:"form.intro"}})],1),e._v(" "),a("el-form-item",{staticStyle:{width:"50%"},attrs:{label:"性别",prop:"gender"}},[a("el-radio-group",{model:{value:e.form.gender,callback:function(t){e.$set(e.form,"gender",t)},expression:"form.gender"}},[a("el-radio",{attrs:{label:"male"}},[e._v("男")]),e._v(" "),a("el-radio",{attrs:{label:"female"}},[e._v("女")]),e._v(" "),a("el-radio",{attrs:{label:"unset"}},[e._v("保密")])],1)],1),e._v(" "),-1==e.flag?a("el-form-item",{staticStyle:{width:"50%","margin-bottom":"0"},attrs:{label:"海报"}},[a("span",{directives:[{name:"show",rawName:"v-show",value:0==e.userposter.length,expression:"userposter.length==0"}]},[e._v("暂无海报")])]):e._e(),e._v(" "),-1==e.flag?a("el-upload",{attrs:{action:e.baseURL,"list-type":"picture-card","before-upload":e.beforeAvatarUpload,"on-preview":e.handlePictureCardPreview,"on-success":e.handleImagePoster,"file-list":e.userposter,"on-remove":e.handleRemove}},[a("i",{staticClass:"el-icon-plus"})]):e._e(),e._v(" "),e.userworks.length>0&&-1==e.flag?a("el-form-item",{attrs:{label:"作品列表"}},[a("el-row",e._l(e.userworks,function(t,r){return a("el-col",{key:r,attrs:{span:8}},[a("el-card",[a("video",{staticStyle:{width:"100%",height:"220px"},attrs:{src:t.videoUrl,poster:t.videoCoverUrl,controls:"controls"}}),e._v(" "),a("img",{staticClass:"image",staticStyle:{width:"100%",height:"120px","object-fit":"cover"},attrs:{src:t.imageUrl},on:{click:function(a){e.handlePictureCardPreview(t.imageUrl)}}}),e._v(" "),a("div",[e._v("背景音乐："+e._s(t.musicName))]),e._v(" "),a("div",[a("el-button",{staticStyle:{padding:"5px"},attrs:{type:"text"},on:{click:function(a){e.addWorksflag(t)}}},[e._v("编辑")]),e._v(" "),a("el-button",{staticStyle:{padding:"5px","margin-left":"20px"},attrs:{type:"text"},on:{click:function(a){e.deleteWorks(t.id)}}},[e._v("删除")])],1)])],1)}))],1):e._e(),e._v(" "),0==e.userworks.length&&-1==e.flag?a("el-form-item",{staticStyle:{width:"50%","margin-bottom":"0"},attrs:{label:"海报"}},[a("span",[e._v("暂无作品")])]):e._e(),e._v(" "),-1==e.flag?a("el-form-item",{attrs:{label:""}},[a("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-edit"},on:{click:function(t){e.addWorksflag(-1)}}},[e._v("添加作品")])],1):e._e(),e._v(" "),a("el-form-item",{attrs:{label:""}},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.submitRes("form")}}},[e._v("确 定")]),e._v(" "),a("el-button",{on:{click:function(t){e.goBack()}}},[e._v("返回")])],1)],1),e._v(" "),a("el-dialog",{attrs:{visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("img",{attrs:{width:"100%",src:e.dialogImageUrl,alt:""}})]),e._v(" "),a("el-dialog",{attrs:{title:e.titleWorks,visible:e.dialogWorks},on:{"update:visible":function(t){e.dialogWorks=t}}},[a("el-form",{attrs:{model:e.formWorkers}},[a("el-form-item",{staticStyle:{width:"50%"},attrs:{label:"背景音乐","label-width":"80px"}},[a("el-input",{attrs:{placeholder:"请输入背景音乐"},model:{value:e.formWorkers.musicName,callback:function(t){e.$set(e.formWorkers,"musicName",t)},expression:"formWorkers.musicName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"封面图片","label-width":"80px"}},[a("el-upload",{staticClass:"upload-demo",staticStyle:{display:"inline-block"},attrs:{"before-upload":e.beforeAvatarUpload,drag:"","on-success":e.handleImageUrl,action:e.baseURL}},[a("i",{staticClass:"el-icon-upload"}),e._v(" "),a("div",{staticClass:"el-upload__text"},[e._v("将文件拖到此处，或"),a("em",[e._v("点击上传")])])]),e._v(" "),e.formWorkers.imageUrl?a("div",{staticStyle:{display:"inline-block","margin-left":"10px","vertical-align":"middle"}},[a("img",{staticStyle:{"max-height":"200px",cursor:"pointer"},attrs:{src:e.formWorkers.imageUrl,alt:"",width:"180px"},on:{click:function(t){e.handlePictureCardPreview(e.formWorkers.imageUrl)}}})]):e._e()],1),e._v(" "),a("el-form-item",{attrs:{label:"上传视频","label-width":"80px"}},[a("el-upload",{staticClass:"upload-demo",staticStyle:{display:"inline-block"},attrs:{"before-upload":e.beforeVideoUpload,drag:"","on-success":e.handleVideoUrl,action:e.baseURL}},[a("i",{staticClass:"el-icon-upload"}),e._v(" "),a("div",{staticClass:"el-upload__text"},[e._v("将文件拖到此处，或"),a("em",[e._v("点击上传")])])]),e._v(" "),e.formWorkers.videoUrl?a("div",{staticStyle:{display:"inline-block","margin-left":"10px","vertical-align":"middle"}},[a("video",{staticStyle:{"margin-top":"5px",width:"60%",height:"180px"},attrs:{src:e.formWorkers.videoUrl,poster:e.formWorkers.videoCoverUrl,controls:"controls"}})]):e._e()],1),e._v(" "),a("el-form-item",{attrs:{label:"视频图片","label-width":"80px"}},[a("el-upload",{staticClass:"upload-demo",staticStyle:{display:"inline-block"},attrs:{"before-upload":e.beforeAvatarUpload,drag:"","on-success":e.handleVideoCoverUrl,action:e.baseURL}},[a("i",{staticClass:"el-icon-upload"}),e._v(" "),a("div",{staticClass:"el-upload__text"},[e._v("将文件拖到此处，或"),a("em",[e._v("点击上传")])])]),e._v(" "),e.formWorkers.videoCoverUrl?a("div",{staticStyle:{display:"inline-block","margin-left":"10px","vertical-align":"middle"}},[a("img",{staticStyle:{"max-height":"200px",cursor:"pointer"},attrs:{src:e.formWorkers.videoCoverUrl,alt:"",width:"180px"},on:{click:function(t){e.handlePictureCardPreview(e.formWorkers.videoCoverUrl)}}})]):e._e()],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogWorks=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.submitWorker()}}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var l=a("VU/8")(o,s,!1,function(e){a("NRHt")},null,null);t.default=l.exports},NRHt:function(e,t,a){var r=a("+WC7");"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);a("rjj0")("f426c5ec",r,!0)}});